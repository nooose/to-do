<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script src="https://unpkg.com/typeit@8.3.3/dist/index.umd.js"></script>
    <script src="https://unpkg.com/scroll-out/dist/scroll-out.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
            crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/form.css"/>
    <title>TODO</title>
</head>
<body>
<div class="site-wrap">
    <form th:action="${status?.update} ? '/notes/' + ${note.id} + '/update' : '/notes/new'" th:object="${note}" th:method="post">
        <section data-scroll>
            <input th:value="${note?.title}" th:field="*{title}" type="text" class="form-control" id="title" name="title" required
                   placeholder="제목" onkeypress="keyEvent(this)">
            <textarea th:text="${note?.body}" th:field="*{body}" class="form-control" id="content" name="body" rows="5" required
                      placeholder="내용"></textarea>
            <br>
            <input class="form-check-input me-2" type="checkbox" value="" aria-label="..." th:field="*{todos[0].status}" />
            <input type="hidden" className="form-control" th:field="*{todos[0].todo}" required value="">
                <div class="form-outline flex-fill" style="display: flex; flex-wrap: wrap">
                    <input type="text" id="todo" class="form-control" placeholder="할 일" style="flex: 1 1 80%; font-size: 17px"/>
                    <button type="button" id="addTodo" class="btn btn-primary" style="font-size: 17px">Add</button>
                </div>
                <ul class="list-group mb-0" id="toDoList" style="list-style: none">
                    <th:block th:if="${note?.todos}">
                        <div class="d-flex align-items-center" th:each="todo : *{todos}">
                            <input class="form-check-input me-2" type="checkbox" aria-label="..." name="status" th:check="${todo.status}"/>
                            <input type="hidden" className="form-control" id="todos" name="todos" required th:value="${todo.todo}">
                            <span th:text="${todo.todo}"></span>
                            <svg xmlns="http://www.w3.org/2000/svg" id="'+ toDos.length +'" onclick="deleteTodo(this)" width="16" height="16" fill="currentColor" className="bi bi-x" viewBox="0 0 16 16">
                                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                            </svg>
                        </div>
                    </th:block>
                </ul>
        </section>
        <div id="save">
            <button type="submit" class="btn btn-success btn-lg">저장</button>
            <button th:if="${status?.update}" type="button" class="btn btn-danger btn-lg" data-bs-toggle="modal"
                    data-bs-target="#Modal">
                삭제
            </button>
            <button type="button" class="btn btn-secondary btn-lg" th:onclick="'history.back()'">취소</button>
        </div>
    </form>
</div>

<!-- Modal -->
<div th:if="${status?.update}" class="modal fade" id="Modal" tabindex="-1" aria-labelledby="ModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="ModalLabel">정말 삭제 하시겠습니까?</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-footer">
                <form th:action="'/notes/' + ${note.id} + '/delete'" th:method="post">
                    <button type="submit" class="btn btn-danger">삭제</button>
                </form>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    function keyEvent() {
        if (event.keyCode === 13 || event.keyCode === 40) {
            document.getElementById("content").focus();
        }
    }
</script>
<script>
    ScrollOut({
        onShown: (element) => {
            new TypeIt(element.querySelector('.title'), {
                startDelay: 100,
                cursor: false,
            })
                .pause(2000)
                .go();
        },
    });
</script>
<script>
    const todoContent = document.querySelector("#todo");
    const addTodo = document.querySelector("#addTodo");
    const todoList = document.querySelector("#toDoList");

    const toDos = new Array();
    function addTodoList() {
        const todo = todoContent.value;
        if (todo == '') {
            todoContent.focus();
            return;
        }

        const todoElement = document.createElement('li');
        todoElement.setAttribute('id', toDos.length);
        todoElement.innerHTML = '<div class="d-flex align-items-center">\n' +
            '                  <input class="form-check-input me-2" type="checkbox" value="" aria-label="..." th:field="*{todos[0].status}" />\n' + todo +
            '                <input type="hidden" className="form-control" th:field="*{todos[0].todo}" required value=' + todo + '> ' +
            '                    <svg xmlns="http://www.w3.org/2000/svg" id="'+ toDos.length +'" onclick="deleteTodo(this)" width="16" height="16" fill="currentColor"\n' +
            '                         className="bi bi-x" viewBox="0 0 16 16">\n' +
            '                        <path\n' +
            '                                d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>\n' +
            '                    </svg>\n' +
            '                <br>' +
            '                </div>'

        toDos.push(todo);
        console.log(todo);
        console.log(toDos);
        todoList.appendChild(todoElement);
        todoContent.value = '';
        todoContent.focus();
    }
    addTodo.addEventListener("click", addTodoList);

    function deleteTodo(element) {
        element.parentNode.remove();
    }

</script>
</html>
